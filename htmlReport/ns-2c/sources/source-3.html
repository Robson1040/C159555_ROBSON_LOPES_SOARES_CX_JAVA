


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > SimuladorMercado</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">br.gov.caixa.api.investimentos.service.simulacao</a>
</div>

<h1>Coverage Summary for Class: SimuladorMercado (br.gov.caixa.api.investimentos.service.simulacao)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">SimuladorMercado</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (10/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    47,9%
  </span>
  <span class="absValue">
    (35/73)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    67,6%
  </span>
  <span class="absValue">
    (50/74)
  </span>
</td>
</tr>
  <tr>
    <td class="name">SimuladorMercado$1</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">SimuladorMercado$CenarioEconomico</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (8/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">SimuladorMercado$CenarioMercado</td>
<td class="coverageStat">
  <span class="percent">
    60%
  </span>
  <span class="absValue">
    (3/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    77,8%
  </span>
  <span class="absValue">
    (7/9)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    88,9%
  </span>
  <span class="absValue">
    (16/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    47,9%
  </span>
  <span class="absValue">
    (35/73)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    71,7%
  </span>
  <span class="absValue">
    (66/92)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package br.gov.caixa.api.investimentos.service.simulacao;
&nbsp;
&nbsp;import jakarta.enterprise.context.ApplicationScoped;
&nbsp;import br.gov.caixa.api.investimentos.enums.produto.TipoProduto;
&nbsp;import br.gov.caixa.api.investimentos.enums.produto.TipoRentabilidade;
&nbsp;
&nbsp;import java.math.BigDecimal;
&nbsp;import java.math.RoundingMode;
&nbsp;import java.time.LocalDate;
&nbsp;import java.util.Random;
&nbsp;
&nbsp;/**
&nbsp; * Simulador de cenários de mercado que cria condições econômicas
&nbsp; * realistas baseadas no tempo e tipo de investimento
&nbsp; */
&nbsp;@ApplicationScoped
<b class="fc">&nbsp;public class SimuladorMercado {</b>
&nbsp;
<b class="fc">&nbsp;    private final Random random = new Random();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Gera um cenário de mercado baseado no período e tipo de produto
&nbsp;     */
&nbsp;    public CenarioMercado gerarCenario(TipoProduto tipoProduto, int prazoMeses) {
<b class="fc">&nbsp;        CenarioEconomico cenario = definirCenarioEconomico(prazoMeses);</b>
<b class="fc">&nbsp;        BigDecimal multiplicadorRisco = calcularMultiplicadorRisco(tipoProduto, cenario);</b>
<b class="fc">&nbsp;        String descricao = gerarDescricaoCenario(cenario, prazoMeses);</b>
&nbsp;        
<b class="fc">&nbsp;        return new CenarioMercado(cenario, multiplicadorRisco, descricao, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Define o cenário econômico baseado no período
&nbsp;     */
&nbsp;    private CenarioEconomico definirCenarioEconomico(int prazoMeses) {
&nbsp;        // Probabilidades diferentes para cada período
<b class="fc">&nbsp;        double probabilidade = random.nextDouble();</b>
&nbsp;        
<b class="pc">&nbsp;        if (prazoMeses &lt;= 6) {</b>
&nbsp;            // Curto prazo - mais estável
<b class="nc">&nbsp;            if (probabilidade &lt; 0.6) return CenarioEconomico.ESTAVEL;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.8) return CenarioEconomico.CRESCIMENTO_MODERADO;</b>
<b class="nc">&nbsp;            return CenarioEconomico.VOLATIL;</b>
<b class="fc">&nbsp;        } else if (prazoMeses &lt;= 12) {</b>
&nbsp;            // Médio prazo - variação moderada
<b class="fc">&nbsp;            if (probabilidade &lt; 0.3) return CenarioEconomico.RECESSAO_LEVE;</b>
<b class="pc">&nbsp;            if (probabilidade &lt; 0.5) return CenarioEconomico.ESTAVEL;</b>
<b class="pc">&nbsp;            if (probabilidade &lt; 0.75) return CenarioEconomico.CRESCIMENTO_MODERADO;</b>
<b class="fc">&nbsp;            return CenarioEconomico.CRESCIMENTO_FORTE;</b>
<b class="pc">&nbsp;        } else if (prazoMeses &lt;= 24) {</b>
&nbsp;            // Longo prazo - maior variabilidade
<b class="pc">&nbsp;            if (probabilidade &lt; 0.2) return CenarioEconomico.RECESSAO_FORTE;</b>
<b class="fc">&nbsp;            if (probabilidade &lt; 0.35) return CenarioEconomico.RECESSAO_LEVE;</b>
<b class="fc">&nbsp;            if (probabilidade &lt; 0.5) return CenarioEconomico.ESTAVEL;</b>
<b class="fc">&nbsp;            if (probabilidade &lt; 0.7) return CenarioEconomico.CRESCIMENTO_MODERADO;</b>
<b class="pc">&nbsp;            if (probabilidade &lt; 0.9) return CenarioEconomico.CRESCIMENTO_FORTE;</b>
<b class="nc">&nbsp;            return CenarioEconomico.BOOM_ECONOMICO;</b>
&nbsp;        } else {
&nbsp;            // Muito longo prazo - ciclos completos possíveis
<b class="nc">&nbsp;            if (probabilidade &lt; 0.15) return CenarioEconomico.RECESSAO_FORTE;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.25) return CenarioEconomico.RECESSAO_LEVE;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.4) return CenarioEconomico.ESTAVEL;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.6) return CenarioEconomico.CRESCIMENTO_MODERADO;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.8) return CenarioEconomico.CRESCIMENTO_FORTE;</b>
<b class="nc">&nbsp;            if (probabilidade &lt; 0.95) return CenarioEconomico.BOOM_ECONOMICO;</b>
<b class="nc">&nbsp;            return CenarioEconomico.VOLATIL;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Calcula multiplicador de risco baseado no tipo de produto e cenário
&nbsp;     */
&nbsp;    private BigDecimal calcularMultiplicadorRisco(TipoProduto tipoProduto, CenarioEconomico cenario) {
<b class="fc">&nbsp;        BigDecimal baseMultiplier = getMultiplicadorBaseProduto(tipoProduto);</b>
<b class="fc">&nbsp;        BigDecimal cenarioAdjustment = getAjusteCenario(cenario);</b>
&nbsp;        
<b class="fc">&nbsp;        return baseMultiplier.multiply(cenarioAdjustment)</b>
<b class="fc">&nbsp;                           .setScale(4, RoundingMode.HALF_UP);</b>
&nbsp;    }
&nbsp;
&nbsp;    private BigDecimal getMultiplicadorBaseProduto(TipoProduto tipoProduto) {
<b class="pc">&nbsp;        return switch (tipoProduto) {</b>
<b class="fc">&nbsp;            case POUPANCA -&gt; new BigDecimal(&quot;0.95&quot;);      // Mais conservador</b>
<b class="fc">&nbsp;            case CDB, LCI, LCA -&gt; new BigDecimal(&quot;1.00&quot;); // Neutro</b>
<b class="fc">&nbsp;            case TESOURO_DIRETO -&gt; new BigDecimal(&quot;1.02&quot;); // Ligeiramente melhor</b>
<b class="nc">&nbsp;            case DEBENTURE -&gt;  new BigDecimal(&quot;-0.06&quot;);</b>
<b class="nc">&nbsp;            case CRI -&gt; new BigDecimal(&quot;-0.06&quot;);</b>
<b class="nc">&nbsp;            case FUNDO -&gt; new BigDecimal(&quot;1.15&quot;);         // Mais agressivo</b>
<b class="nc">&nbsp;            case FII -&gt; new BigDecimal(&quot;-0.06&quot;);</b>
<b class="nc">&nbsp;            case ACAO -&gt; new BigDecimal(&quot;-0.06&quot;);</b>
<b class="nc">&nbsp;            case ETF -&gt; new BigDecimal(&quot;-0.06&quot;);</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    private BigDecimal getAjusteCenario(CenarioEconomico cenario) {
<b class="pc">&nbsp;        return switch (cenario) {</b>
<b class="nc">&nbsp;            case RECESSAO_FORTE -&gt; new BigDecimal(&quot;0.70&quot;);</b>
<b class="fc">&nbsp;            case RECESSAO_LEVE -&gt; new BigDecimal(&quot;0.85&quot;);</b>
<b class="fc">&nbsp;            case ESTAVEL -&gt; new BigDecimal(&quot;1.00&quot;);</b>
<b class="fc">&nbsp;            case CRESCIMENTO_MODERADO -&gt; new BigDecimal(&quot;1.15&quot;);</b>
<b class="fc">&nbsp;            case CRESCIMENTO_FORTE -&gt; new BigDecimal(&quot;1.30&quot;);</b>
<b class="nc">&nbsp;            case BOOM_ECONOMICO -&gt; new BigDecimal(&quot;1.50&quot;);</b>
<b class="nc">&nbsp;            case VOLATIL -&gt; new BigDecimal(&quot;0.80&quot;);</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Gera descrição do cenário simulado
&nbsp;     */
&nbsp;    private String gerarDescricaoCenario(CenarioEconomico cenario, int prazoMeses) {
<b class="fc">&nbsp;        String periodo = getPeriodoDescricao(prazoMeses);</b>
<b class="fc">&nbsp;        String descricaoCenario = getDescricaoCenario(cenario);</b>
<b class="fc">&nbsp;        LocalDate dataSimulacao = LocalDate.now();</b>
&nbsp;        
<b class="fc">&nbsp;        return String.format(&quot;Simulação para %s (%s) - Cenário: %s - Data base: %s&quot;, </b>
&nbsp;                           periodo, prazoMeses + &quot; meses&quot;, descricaoCenario, dataSimulacao);
&nbsp;    }
&nbsp;
&nbsp;    private String getPeriodoDescricao(int prazoMeses) {
<b class="pc">&nbsp;        if (prazoMeses &lt;= 3) return &quot;Curto Prazo&quot;;</b>
<b class="pc">&nbsp;        if (prazoMeses &lt;= 6) return &quot;Médio-Curto Prazo&quot;;</b>
<b class="fc">&nbsp;        if (prazoMeses &lt;= 12) return &quot;Médio Prazo&quot;;</b>
<b class="pc">&nbsp;        if (prazoMeses &lt;= 24) return &quot;Longo Prazo&quot;;</b>
<b class="nc">&nbsp;        return &quot;Muito Longo Prazo&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    private String getDescricaoCenario(CenarioEconomico cenario) {
<b class="pc">&nbsp;        return switch (cenario) {</b>
<b class="nc">&nbsp;            case RECESSAO_FORTE -&gt; &quot;Recessão Forte - Queda significativa na atividade econômica&quot;;</b>
<b class="fc">&nbsp;            case RECESSAO_LEVE -&gt; &quot;Recessão Leve - Desaceleração moderada da economia&quot;;</b>
<b class="fc">&nbsp;            case ESTAVEL -&gt; &quot;Economia Estável - Crescimento moderado e inflação controlada&quot;;</b>
<b class="fc">&nbsp;            case CRESCIMENTO_MODERADO -&gt; &quot;Crescimento Moderado - Expansão econômica sustentável&quot;;</b>
<b class="fc">&nbsp;            case CRESCIMENTO_FORTE -&gt; &quot;Crescimento Forte - Expansão acelerada da economia&quot;;</b>
<b class="nc">&nbsp;            case BOOM_ECONOMICO -&gt; &quot;Boom Econômico - Crescimento excepcional com possível superaquecimento&quot;;</b>
<b class="nc">&nbsp;            case VOLATIL -&gt; &quot;Alta Volatilidade - Incertezas e oscilações frequentes no mercado&quot;;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Ajusta a rentabilidade baseada no cenário de mercado
&nbsp;     */
&nbsp;    public BigDecimal ajustarRentabilidadePorCenario(BigDecimal rentabilidadeBase, 
&nbsp;                                                   CenarioMercado cenario,
&nbsp;                                                   TipoRentabilidade tipoRentabilidade) {
<b class="fc">&nbsp;        BigDecimal multiplicador = cenario.getMultiplicadorRisco();</b>
&nbsp;        
&nbsp;        // Produtos pós-fixados são mais sensíveis ao cenário
<b class="fc">&nbsp;        if (TipoRentabilidade.POS.equals(tipoRentabilidade)) {</b>
<b class="fc">&nbsp;            multiplicador = multiplicador.multiply(new BigDecimal(&quot;1.2&quot;));</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        return rentabilidadeBase.multiply(multiplicador)</b>
<b class="fc">&nbsp;                              .setScale(4, RoundingMode.HALF_UP);</b>
&nbsp;    }
&nbsp;
&nbsp;    // Enums e classes internas
<b class="fc">&nbsp;    public enum CenarioEconomico {</b>
<b class="fc">&nbsp;        RECESSAO_FORTE,</b>
<b class="fc">&nbsp;        RECESSAO_LEVE, </b>
<b class="fc">&nbsp;        ESTAVEL,</b>
<b class="fc">&nbsp;        CRESCIMENTO_MODERADO,</b>
<b class="fc">&nbsp;        CRESCIMENTO_FORTE,</b>
<b class="fc">&nbsp;        BOOM_ECONOMICO,</b>
<b class="fc">&nbsp;        VOLATIL</b>
&nbsp;    }
&nbsp;
&nbsp;    public static class CenarioMercado {
&nbsp;        private final CenarioEconomico cenario;
&nbsp;        private final BigDecimal multiplicadorRisco;
&nbsp;        private final String descricao;
&nbsp;        private final boolean simulado;
&nbsp;
&nbsp;        public CenarioMercado(CenarioEconomico cenario, BigDecimal multiplicadorRisco, 
<b class="fc">&nbsp;                            String descricao, boolean simulado) {</b>
<b class="fc">&nbsp;            this.cenario = cenario;</b>
<b class="fc">&nbsp;            this.multiplicadorRisco = multiplicadorRisco;</b>
<b class="fc">&nbsp;            this.descricao = descricao;</b>
<b class="fc">&nbsp;            this.simulado = simulado;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Getters
<b class="nc">&nbsp;        public CenarioEconomico getCenario() { return cenario; }</b>
<b class="fc">&nbsp;        public BigDecimal getMultiplicadorRisco() { return multiplicadorRisco; }</b>
<b class="fc">&nbsp;        public String getDescricao() { return descricao; }</b>
<b class="nc">&nbsp;        public boolean isSimulado() { return simulado; }</b>
&nbsp;    }
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-11-16 12:04</div>
</div>
</body>
</html>
